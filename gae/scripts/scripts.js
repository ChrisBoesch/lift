"use strict";var app=angular.module("liftApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngProgress","ui.calendar","ui.bootstrap","restangular"]);app.constant("API_BASE_URL","api/v1"),app.config(["$routeProvider","$locationProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/medicine",{templateUrl:"views/medicine.html",controller:"MedicineCtrl"}).when("/testResults",{templateUrl:"views/testResults.html",controller:"TestResultsCtrl"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl"}).when("/meters",{templateUrl:"views/meters.html",controller:"MetersCtrl"}).when("/clinician",{templateUrl:"views/clinician.html",controller:"ClinicianCtrl"}).when("/",{templateUrl:"views/physician.html",controller:"PhysicianCtrl"}).when("/patients/:patient_id",{templateUrl:"views/patients.html",controller:"PatientsCtrl",resolve:{selectedPatient:["$route","PatientService",function(a,b){var c=a.current.params.patient_id;return b.getPatientById(c)}]}}).when("/patients/:patient_id/charts",{templateUrl:"views/charts.html",controller:"ChartsCtrl",resolve:{selectedPatient:["$route","PatientService",function(a,b){var c=a.current.params.patient_id;return b.getPatientById(c)}]}}).otherwise({redirectTo:"/"})}]);var interceptor=function(a,b,c){var d;return"getList"===b?(d=a[c]?a[c]:[],d.cursor=a.cursor?a.cursor:null):d=a,d},app=angular.module("liftApp");app.service("PatientAPI",["Restangular","API_BASE_URL",function(a,b){return a.withConfig(function(a){a.setBaseUrl(b),a.addResponseInterceptor(interceptor)})}]),app.service("PatientService",["PatientAPI",function(a){return{getPatients:function(){return a.all("patients").getList()},addPatient:function(b){return a.all("patients").post(b)},addMedication:function(b,c){return a.one("patients",b).all("medication").post(c)},getPatientById:function(b){return a.one("patients",b).get()},getMedicationInformation:function(b){return a.one("patients",b).one("medication").get()}}}]),angular.module("liftApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Overview",link:"/"},{title:"Health Meters",link:"/meters"},{title:"Medicine",link:"/medicine"},{title:"History",link:"/history"},{title:"Test Results",link:"/testResults"},{title:"Physician",link:"/physician"}],a.isActive=function(a){return a===b.path()},a.users=[{name:"Melba Brewster",username:"melba"},{name:"Harriett Hodges",username:"hhodges"},{name:"Thomas Frost",username:"tfrost"},{name:"Diane Sparks",username:"sparks231"}],a.activeUser=a.users[0],a.chooseUser=function(b){a.activeUser=b}}]),angular.module("liftApp").controller("HomeCtrl",["$scope",function(a){a.meters=["127","Abdominal Cramps","Benadryl","Calories","Constipation","Decreased Hearing","Ear Ache","Ear Echo Right"]}]);var Holder=Holder||{},app=angular.module("liftApp");app.directive("linechart",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the linechart directive")}}}),app.directive("holderFix",function(){return{link:function(a,b){Holder.run({images:b[0],nocss:!0})}}}),app.directive("setFocus",function(){return{restrict:"E",link:function(a,b){b[0].focus()}}}),app.directive("laDataChart",function(){return{restrict:"E",scope:{data:"="},templateUrl:"views/charts/line.html",link:function(a){a.graph={width:800,height:350},a.layout={top:40,right:40,bottom:40,left:40},a.totalWidth=a.graph.width+a.layout.left+a.layout.right,a.totalHeight=a.graph.height+a.layout.top+a.layout.bottom;var b=d3.time.scale().rangeRound([0,a.graph.width]);b.domain(d3.extent(a.data,function(a){return a.date}));var c=d3.max(a.data,function(a){return a.glucose})+10,d=d3.min(a.data,function(a){return a.glucose});a.meanGlucose=d3.mean(a.data,function(a){return a.glucose});var e=d3.max(a.data,function(a){return a.temp})+10,f=d3.min(a.data,function(a){return a.temp});a.meanTemp=d3.mean(a.data,function(a){return a.temp});var g=d3.scale.linear().domain([d,c]).range([a.graph.height/2,0]),h=d3.scale.linear().domain([f,e]).range([a.graph.height/2,0]),i=d3.svg.line().x(function(a){return b(a.date)}).y(function(a){return g(a.glucose)}).interpolate("linear"),j=d3.svg.line().x(function(a){return b(a.date)}).y(function(a){return h(a.temp)}).interpolate("linear").interpolate("linear");a.glucoseMean=g(a.meanGlucose),a.tempMean=h(a.meanTemp);var k=d3.svg.axis().scale(g).orient("left").ticks(6),l=d3.svg.axis().scale(h).orient("right").ticks(10),m=d3.svg.axis().scale(b).orient("bottom").tickPadding(8).tickSize(0).ticks(d3.time.hours,6),n=d3.select("svg .chart-container");n.append("g").attr("class","x axis ").attr("transform","translate(0,"+a.graph.height/2+")").call(m),n.append("g").attr("class","y axis glucose").call(k),n.append("g").attr("class","y axis temp").attr("transform","translate("+a.graph.width+",0)").call(l),a.line1Path=i(a.data),a.line2Path=j(a.data),a.glCircles=[],a.tempCircles=[],a.medData=[];var o={};angular.forEach(a.data,function(c){var d={cx:b(c.date),cy:g(c.glucose)},e={cx:b(c.date),cy:h(c.temp)};angular.forEach(c.medicines,function(a){var d=o[a.name];d||(d={},d.name=a.name,d.data=[],o[a.name]=d);var e=1==a.value?"taken":"not-taken";d.data.push({className:e,cx:b(c.date)})}),a.glCircles.push(d),a.tempCircles.push(e)}),a.medData=o}}}),angular.module("liftApp").controller("MedicineCtrl",["$scope",function(a){a.activeMedicines=[{drugName:"Metformin",dosage:"500 mg 2-3 times daily",classification:"Anti Diabetic agents"},{drugName:"Amidiopine",dosage:"2.5 mg once daily",classification:"Calcium Antagonist"},{drugName:"Catapres",dosage:"75-150 mgc twice daily",classification:"Anti Hypertensive"},{drugName:"Metopolol",dosage:"50-100 mg once daily",classification:"Beta Blockers"}]}]),angular.module("liftApp").controller("TestResultsCtrl",["$scope",function(a){a.testResults=[{testName:"Urine Test",date:"11/14/2013",result:"Normal"},{testName:"Blood Test",date:"11/14/2013",result:"Normal"},{testName:"Blood Glucose Test",date:"11/14/2013",result:"Normal"},{testName:"Blood Urea Nitrogen (BUN) Test",date:"11/14/2013",result:"Normal"},{testName:"Electrocardiogram (ECG) Test",date:"11/12/2013",result:"Normal"}]}]),angular.module("liftApp").controller("HistoryCtrl",["$scope",function(a){a.history=[{date:"December 5, 2012 6:00 PM",text:"Physician changed the dosage of Amelodopine from 2.5mg to 5mg daily"},{date:"November 10, 2012 5:00 PM",text:"Physician order: Take blood pressure every 4 hours"},{date:"November 09, 2012 6:00 PM",text:"Clinical Visit: Dr. Mendez at Philippine General Hospital",extraInfo:"Details..."},{date:"November 5, 2012 6:00 PM",text:"Physician prescribed the dosage of Amelodopine 2.5mg daily"}]}]),angular.module("liftApp").controller("MetersCtrl",["$scope",function(a){a.events=[{date:"11/14/2012 02:00PM",event:"Follow up checkup with Dr. Russel (Cardiologist)"},{date:"11/14/2012 08:00AM",event:"Amelodopine 10mg"},{date:"11/14/2012 06:00AM",event:"Light Jogging"},{date:"11/15/2012 09:00AM",event:"Physical Therapy Session with Dr. Santos(PT)"},{date:"11/15/2012 08:00AM",event:"Metformin 50mg"}]}]);var app=angular.module("liftApp");app.controller("ClinicianCtrl",["$scope",function(a){a.uiConfig={calendar:{height:450,editable:!0,header:{right:"month,agendaWeek,agendaDay",center:"title",left:"prev,next today"}}},a.eventSources=[],a.patientInfo=[{type:"chronic",number:80,percentage:40,icon:"fa-ambulance"},{type:"nominal",number:80,percentage:40,icon:"fa-medkit"},{type:"acute",number:20,percentage:10,icon:"fa-wheelchair"},{type:"new",number:20,percentage:10,icon:"fa-plus-square"}],a.transactionHistory=[{date:"Dec 5, 2012 5:00 PM",text:"[patient Eric] Increased dosage of Amlodopine from 2.5mg to 5mg daily"},{date:"Nov 16, 2012 9:00 AM",text:"[patient Eric] ordered to take blood pressure every 4 hours"},{date:"Nov 15, 2012 9:00 AM",text:"[patient Eric] regular clinical visit"},{date:"Nov 5, 2012 5:00 PM",text:"[patient Eric] Prescribed Amlodopine 2.5mg daily"}],a.prescriptionHistory=[{label:"Amlodopine 5mg Tablet",qty:30,dosage:"5mg OD",classification:"Calcium Antagonist",pharmacy:"Metro Drug"},{label:"Catapres 0.1mg tablet",qty:60,dosage:"0.1mg bd",classification:"Anti Hypertensive",pharmacy:"Metro Drug"},{label:"Metformin",qty:60,dosage:"500mg bd",classification:"Anti Diabetic Agent",pharmacy:"Metro Drug"},{label:"Metapolol Tablet",qty:30,dosage:"50mg OD",classification:"Beta Blockers",pharmacy:"Metro Drug"},{label:"Instamet",qty:60,dosage:"500mg",classification:"Anti Diabetic Agent",pharmacy:"Metro Drug"}]}]);var app=angular.module("liftApp");app.controller("PhysicianCtrl",["$scope","$modal","PatientService",function(a,b,c){var d=new Date;d.setMonth(d.getMonth()-12);var e={gender:"male",dateOfBirth:d};a.patients=c.getPatients().$object,a.patient=e,a.openDialog=function(){a.modalInstance=b.open({templateUrl:"views/addPatient.html",controller:"AddPatientModalInstanceCtrl",resolve:{patient:function(){return a.patient}}}),a.modalInstance.result.then(function(b){var d={};angular.extend(d,b),d.name=d.firstName+" "+d.lastName,c.addPatient(d),a.patient=e,a.patients=c.getPatients().$object},function(){a.patient=e,a.canceled=!0})},a.openPrescriptionDialog=function(d){a.prescriptionDialogInstance=b.open({templateUrl:"views/prescriptions.html",controller:"PrescriptionInstanceController",windowClass:"prescription-modal",resolve:{patient:function(){return c.getPatientById(d)}}}),a.prescriptionDialogInstance.result.then(function(){a.patient=e,a.patients=c.getPatients().$object},function(){a.patient=e,a.canceled=!0})}}]),app.controller("AddPatientModalInstanceCtrl",["$scope","$modalInstance","$filter","patient",function(a,b,c,d){a.patient=d,a.$watch("patient",function(b){b&&(a.dateString=c("date")(b.dateOfBirth,"yyyy-MM-dd"))}),a.cancel=function(){b.dismiss("cancel")},a.submit=function(c){c&&b.close(a.patient)}}]),app.controller("PrescriptionInstanceController",["$scope","$modalInstance","patient","PatientService",function(a,b,c,d){a.patient=c;var e=["None",[1,0,0],[1,0,1],[1,1,1],4,5,6,8,12,24],f={dose:1,sched:2,type:"tablet",name:""};a.medication=angular.extend({},f),a.cancel=function(){b.dismiss("cancel")},a.submit=function(){b.close(a.patient)},a.addMedication=function(b){if(b){a.patient.prescriptions=a.patient.prescriptions||[];var f=e[a.medication.sched];a.medication.schedule=f,a.medication.date=new Date,d.addMedication(c.id,a.medication).then(function(){a.patient.prescriptions.push(a.medication)})}}}]);var app=angular.module("liftApp");app.filter("toHumanString",function(){return function(a){var b=["none","once","twice","thrice","four times","five times"],c=function(){var c=0;return angular.forEach(a,function(a){c+=a}),b[c]+" daily"};return angular.isArray(a)?c():"every "+a+" hours"}}),app.filter("prescriptionFor",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){angular.isArray(a.schedule)&&1==a.schedule[b]&&this.push(a)},c),c}}),app.filter("rangeFor",function(){return function(a,b,c){for(var d=parseInt(b),e=parseInt(c),f=d;e>=f;f++)a.push(f);return a}}),angular.module("liftApp").controller("PatientsCtrl",["$scope","$routeParams","$filter","selectedPatient",function(a,b,c,d){function e(a,b){var c={};if(c.date=a,c.taken="not-taken",c.type=b.type,c.name=b.name,c.id=b.id,"data"==b.type){c.value=b.range.start,c.optionData=[];for(var d=c.value;d<b.range.end;d++)c.optionData.push(d)}else c.optionData=[],c.optionData.push("Taken"),c.optionData.push("Not Taken"),c.optionData.push("Previously Taken at"),c.value="Not Taken",c.time=new Date;return c}a.patient=d,a.day="Yesterday",a.today=new Date,a.dateStr=c("date")(a.today,"yyyyMMdd");var f=function(){var b={},d=new Date,e=new Date;e.setDate(e.getDate()-1);var f=a.dateStr=c("date")(e,"yyyyMMdd"),h=a.dateStr=c("date")(d,"yyyyMMdd"),i=g(f);b[f]=i;var j=g(h);return b[h]=j,b},g=function(b){var c=[],d={name:"Morning",medications:[]},f={name:"Afternoon",medications:[]},g={name:"Evening",medications:[]},h=a.patient.prescriptions;return angular.forEach(h,function(a){var c=a.schedule;if(angular.isArray(c)){if(1==c[0]){var h=e(b,a);d.medications.push(h)}if(1==c[1]){var h=e(b,a);f.medications.push(h)}if(1==c[2]){var h=e(b,a);g.medications.push(h)}}}),c.push(d),c.push(f),c.push(g),c};a.prescriptions=f(),a.selectedPrescriptions=a.prescriptions[a.dateStr],a.toggleDay=function(){var b=a.day;a.day="Yesterday"==b?"Today":"Yesterday";var d=new Date;d.setDate(d.getDate()-1),a.today="Yesterday"==b?d:new Date,a.dateStr=c("date")(a.today,"yyyyMMdd"),a.selectedPrescriptions=a.prescriptions[a.dateStr]},a.updateMedicineInfo=function(a,b){a.taken=b}}]);var app=angular.module("liftApp");app.controller("ChartsCtrl",["$scope","$location","selectedPatient",function(a,b,c){a.patient=c;var d=function(){return 140+Math.floor(60*Math.random())},e=function(){return 97+4*Math.random()},f=function(a,b){var c=new Date;return c.setDate(c.getDate()-a),c.setHours(b),c.setMinutes(0),c.setSeconds(0),c},g=function(a,b){return{date:f(a,b),glucose:d(),temp:e(),medicines:[{name:"Aspirin 100mg",value:Math.floor(2*Math.random())},{name:"Istamet",value:1},{name:"Olmezest",value:Math.floor(2*Math.random())}]}},h=function(a){for(var b=[],c=a-1;c>=0;c--)b.push(g(c,9)),b.push(g(c,12)),b.push(g(c,18));return b};a.data=h(5)}]);